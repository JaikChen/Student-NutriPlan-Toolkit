
# 🍱 校园营养餐综合管理工具箱 (Student NutriPlan Toolkit)

这是一个基于 Python 的自动化辅助工具，专为**全国农村义务教育学生营养改善计划管理信息系统**设计。旨在帮助学校管理人员解决学生名单核算繁琐、食材入库单据生成量大、以及平台录入重复机械化的问题。

## ✨ 主要功能

本工具箱集成了以下三大核心模块：

1. **🎓 学生名单核算 (`manager_students.py`)**
* 辅助核对各班级用餐人数。
* 处理跨班调剂等特殊情况的学生名单管理。


2. **🥦 食材入库生成 (`manager_inventory.py`)**
* 根据采购计划，自动拆分生成每日的食材入库单 Excel 文件。
* 自动按日期命名文件，便于归档和上传。
* 生成文件自动保存至 `data/2_食材入库管理/输出结果` 目录。


3. **🤖 平台自动录入 (`auto_nutrition.py`)**
* **全自动化上传**：基于 Selenium 技术，自动读取生成的 Excel 文件并上传至全国平台。
* **智能识别**：根据文件名（如 `2025-02-14.xls`）自动判断所属**学年**（如 2024-2025）和**学期**（春季/秋季）。
* **日期强制填充**：通过 JS 注入技术，突破网页日历控件的“只读”限制，精准填入采购与入库日期。
* **稳健模式**：针对网页加载延迟、遮罩层阻挡、按钮点击无效等情况增加了智能等待和强力点击策略。
* **断点续传**：接管已打开的浏览器窗口，无需重复扫码登录，遇到错误可手动纠正后继续运行。



---

## 📂 项目结构

```text
Student-NutriPlan-Toolkit/
├── data/                        # 数据存储目录
│   ├── 1_学生名单管理/           # (需自行建立) 存放学生名单相关文件
│   └── 2_食材入库管理/           # 存放食材相关文件
│       └── 输出结果/             # 自动生成的待上传 Excel 文件存放处
├── auto_nutrition.py            # [核心] 自动化上传脚本 (Selenium)
├── main.py                      # [入口] 程序主菜单入口
├── manager_inventory.py         # [模块] 食材入库单生成脚本
├── manager_students.py          # [模块] 学生名单管理脚本
├── requirements.txt             # (建议创建) 依赖库列表
└── README.md                    # 项目说明文档

```

---

## 🛠️ 环境准备与安装

### 1. 安装 Python

确保您的电脑已安装 Python 3.8 或更高版本。

### 2. 安装依赖库

在项目根目录下打开终端（Terminal / CMD），运行以下命令安装必要的库：

```bash
pip install selenium webdriver-manager pandas openpyxl xlrd

```

*(注：`pandas` 等库可能在 `manager_` 模块中需要，具体视代码依赖而定)*

### 3. 配置 Chrome 浏览器（关键步骤！）

由于自动化脚本需要接管**已登录**的浏览器，请务必按照以下步骤创建一个“专用浏览器快捷方式”：

1. 在桌面上找到 **Google Chrome** 图标。
2. 右键点击 -> **复制**，然后在空白处 **粘贴**，生成一个副本。
3. 重命名副本为：**营养餐自动化专用**。
4. 右键点击该图标 -> **属性**。
5. 在 **“目标”** 一栏的末尾，**添加一个空格**，然后粘贴以下代码：
```text
--remote-debugging-port=9222 --user-data-dir="D:\automation_profile"

```


*示例目标路径：* `"C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222 --user-data-dir="D:\automation_profile"`
6. 点击 **确定** 保存。

---

## 🚀 使用指南

### 第一步：启动专用浏览器

1. 双击桌面上的 **“营养餐自动化专用”** 快捷方式。
2. 在浏览器中打开平台网址：`https://yyjh.xszz.edu.cn/`。
3. **手动完成登录**，并点击进入 **【采购管理】 -> 【食材入库维护】** 页面。
4. 保持浏览器开启，不要关闭。

### 第二步：运行程序

1. 在项目文件夹中，双击运行 `main.py`（或在 IDE/终端中运行）。
2. 你将看到如下主菜单：

```text
============================================================
            🍱 校园营养餐综合管理工具箱
============================================================

请选择要执行的功能：

  [1] 🎓 学生名单核算 (人数核对、跨班调剂)
  [2] 🥦 食材入库生成 (自动拆分每日入库单)
  [3] 🤖 平台自动录入 (Selenium自动化上传)
  [0] ❌ 退出系统
------------------------------------------------------------

```

### 第三步：执行自动化录入

1. 输入 **`3`** 并回车。
2. 程序会自动检测并连接刚才打开的 Chrome 浏览器。
3. 根据提示，确认浏览器已停留在“食材入库维护”界面。
4. 按 **回车键** 开始。
5. 程序将自动执行以下流程：
* 切换学年/学期 -> 点击查询。
* 点击录入 -> 填写“大宗食材” -> 强制填入日期 -> 选择“否”（不继承）。
* 点击清单导入 -> 上传 Excel 文件 -> 等待上传完成 -> 点击确认。
* 在主界面点击提交保存。



---

## ⚠️ 常见问题排查

**Q: 连接失败，提示 "Message: session not created: cannot connect to chrome..."**

* **原因**：电脑后台可能有旧的 Chrome 进程在运行，占用了端口或未开启调试模式。
* **解决**：
1. **彻底关闭**所有 Chrome 窗口（检查右下角托盘图标并退出）。
2. 重新双击 **“营养餐自动化专用”** 快捷方式打开浏览器。
3. 再次运行程序。



**Q: 文件上传时报错或找不到“确定”按钮**

* **解决**：这是由于网速或系统响应慢导致的。目前的脚本已开启“慢速稳健模式”，如果依然报错，请检查网络连接。程序支持断点续传，报错后您可以手动在网页上修正，然后在控制台按回车继续处理下一个文件。

**Q: 网页上的日期没有填进去**

* **解决**：程序使用了 JavaScript 强力注入模式（`removeAttribute('readonly')`），通常不会失效。请确保您没有手动去点击日期输入框干扰程序运行。

---

## 📜 免责声明

本工具仅供学校管理人员减轻重复工作负担使用。请确保上传的数据真实有效。使用本工具产生的任何数据准确性问题，需由操作人员自行核对确认。请勿用于任何非法用途。